#!/usr/bin/dash

cd  "../src/"
# ghc "../src/hsxx.hs" || exit 2
ghc "Hsxx.hs" -outputdir "../test/" -o "../test/hsxx" || exit 2

cd "../test/sxx/"
echo "testing all files in sxx/ ..."

# for filename in $(ls -1 "dantest/*.sxx") ; do
# for filename in dantest/*.sxx ; do
# cd "sxx/"
for filename in *.sxx ; do
    echo "$filename"
#     echo "compare with: .output.$filename"
    ../hsxx "$filename" | \
        awk '/beginning execution --------------------/,0' | \
        diff ".output.$filename" - || exit 1
done

echo "OK :~)"
